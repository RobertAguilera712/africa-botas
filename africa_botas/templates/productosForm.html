{% extends 'plantillaDashboard.html' %}
{% block modulo %}
<div class="container-fluid">
  <h1 class="text-center my-3">{{ operacion }} producto</h1>
  <form class="row" method="post" action="">
    {{ form.hidden_tag() }}
    <div class="col-lg-4 col-md-6 col-sm-12 my-3">
      <div class="form-floating">
        {% if form.nombre.errors %}
        {{ form.nombre(class="form-control is-invalid", placeholder=form.nombre.label.text) }}
        <div class="invalid-feedback">
          {% for error in form.nombre.errors %}
          <span>{{ error }}</span>
          {% endfor %}
        </div>
        {% else %}
        {{ form.nombre(class="form-control", placeholder=form.nombre.label.text) }}
        {% endif %}
        {{ form.nombre.label }}
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 my-3">
      <div class="form-floating">
        {% if form.precio.errors %}
        {{ form.precio(class="form-control is-invalid", placeholder=form.precio.label.text) }}
        <div class="invalid-feedback">
          {% for error in form.precio.errors %}
          <span>{{ error }}</span>
          {% endfor %}
        </div>
        {% else %}
        {{ form.precio(class="form-control", placeholder=form.precio.label.text) }}
        {% endif %}
        {{ form.precio.label }}
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 my-3">
      <div class="form-floating">
        {% if form.modelo.errors %}
        {{ form.modelo(class="form-control is-invalid", placeholder=form.modelo.label.text) }}
        <div class="invalid-feedback">
          {% for error in form.modelo.errors %}
          <span>{{ error }}</span>
          {% endfor %}
        </div>
        {% else %}
        {{ form.modelo(class="form-control", placeholder=form.modelo.label.text) }}
        {% endif %}
        {{ form.modelo.label }}
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 my-3">
      <div class="form-floating">
        {% if form.marca.errors %}
        {{ form.marca(class="form-control is-invalid", placeholder=form.marca.label.text) }}
        <div class="invalid-feedback">
          {% for error in form.marca.errors %}
          <span>{{ error }}</span>
          {% endfor %}
        </div>
        {% else %}
        {{ form.marca(class="form-control", placeholder=form.marca.label.text) }}
        {% endif %}
        {{ form.marca.label }}
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-sm-12 my-3">
      <div class="form-floating">
        {% if form.descripcion.errors %}
        {{ form.descripcion(class="form-control is-invalid", placeholder=form.descripcion.label.text) }}
        <div class="invalid-feedback">
          {% for error in form.descripcion.errors %}
          <span>{{ error }}</span>
          {% endfor %}
        </div>
        {% else %}
        {{ form.descripcion(class="form-control", placeholder=form.descripcion.label.text) }}
        {% endif %}
        {{ form.descripcion.label }}
      </div>
    </div>
    <div class="col-12 d-flex justify-content-center">
      {% if operacion == "Detalle" %}
      <button type="button" class="btn btn-warning m-2" id="btnModificar">Modificar</button>
      {{ form.submit(class="btn btn-info m-2 d-none", id="btnGuardar") }}
      {% else %}
      {{ form.submit(class="btn btn-info m-2 ") }}
      {% endif %}
      <a class="btn btn-danger m-2" href="/producto">Regresar</a>
    </div>
  </form>
  <div class="row">
    <div class="col-md-6">
      <h2>Añadir stock</h2>
      <div class="table-responsive my-4" style="height: 250px;">
        <table class="table text-center">
          <thead>
            <tr>
              <th>Talla</th>
              <th>Existencias</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaAgregarStock">
            {% for talla in tallas %}
            <div id="{{ talla._id}}">
              <form onsubmit="agregarStock(event)">
                <tr>
                  <td>{{ talla.talla }}</td>
                  <td><input type="number" name="existencias" class="form-control" required min="1"></td>
                  <td>
                    <input type="submit" class="btn btn-primary" value="Añadir">
                    <button type="button" class="btn btn-warning d-none">Modificar</button>
                  </td>
                  <input type="hidden" value="{{ talla._id }}" name="idTalla">
                  <input type="hidden" value="{{ talla.talla }}" name="talla">
                </tr>
              </form>
            </div>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-md-6">
      <h2>Stock añadido</h2>
      <div class="table-responsive my-4" style="height: 250px;">
        <table class="table text-center">
          <thead>
            <tr>
              <th>Talla</th>
              <th>Existencias</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tbodyStockAgregado">
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock modulo %}
{% block scripts %}
{{ super() }}
<script>
  stock = []
  tbodyStockAgregado = document.getElementById('tbodyStockAgregado');
  function agregarStock(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    stock.push({ 'talla': formData.get('talla'), 'existencias': formData.get('existencias') });
    stockForm = document.getElementById(formData.get('idTalla'));
    stockForm.remove();
    // tbodyStockAgregado.append(stockForm);
  }
</script>
{% if operacion == "Detalle" %}
<script>
  const inputs = document.querySelectorAll('input:not([type="submit"]), select, textarea')
  inputs.forEach(element => {
    element.disabled = true
  });
  const btnModificar = document.getElementById('btnModificar')
  btnModificar.addEventListener('click', () => {
    inputs.forEach(element => {
      element.disabled = false
    });
    document.getElementById('btnGuardar').classList.remove('d-none')
  });
</script>
{% endif %}
{% endblock scripts %}